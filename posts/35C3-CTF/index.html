<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content=""><meta name="hour-prompt" content=""><meta name="minute-prompt" content=""><meta name="justnow-prompt" content=""><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="35C3 CTF" /><meta name="author" content="Duc Phan" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is my first time participating in C3 CTF. Although I wasn’t able to solve many challenges within the time of the CTF, I still find the challenges really awesome and exciting. I wanted to solve pwnable challenges with the hope to learn more about exploit development of real applications, but ended up solving 2 RE ones. Here is my writeup for them :)" /><meta property="og:description" content="This is my first time participating in C3 CTF. Although I wasn’t able to solve many challenges within the time of the CTF, I still find the challenges really awesome and exciting. I wanted to solve pwnable challenges with the hope to learn more about exploit development of real applications, but ended up solving 2 RE ones. Here is my writeup for them :)" /><link rel="canonical" href="https://ret2.life/posts/35C3-CTF/" /><meta property="og:url" content="https://ret2.life/posts/35C3-CTF/" /><meta property="og:site_name" content="ret2life" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-12-30T11:01:14+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="35C3 CTF" /><meta name="twitter:site" content="@flyingpassword" /><meta name="twitter:creator" content="@Duc Phan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Duc Phan"},"dateModified":"2018-12-30T11:01:14+08:00","datePublished":"2018-12-30T11:01:14+08:00","description":"This is my first time participating in C3 CTF. Although I wasn’t able to solve many challenges within the time of the CTF, I still find the challenges really awesome and exciting. I wanted to solve pwnable challenges with the hope to learn more about exploit development of real applications, but ended up solving 2 RE ones. Here is my writeup for them :)","headline":"35C3 CTF","mainEntityOfPage":{"@type":"WebPage","@id":"https://ret2.life/posts/35C3-CTF/"},"url":"https://ret2.life/posts/35C3-CTF/"}</script><title>35C3 CTF | ret2life</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ret2life"><meta name="application-name" content="ret2life"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://pbs.twimg.com/profile_images/1417881771534819331/0AuUptMd_400x400.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ret2life</a></div><div class="site-subtitle font-italic">From CTF write-ups to everyday life kind of things</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span></span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ducphanduyagentp" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/flyingpassword" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['youreallythingimmaputemail','on.here?'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> </a> </span> <span>35C3 CTF</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" ></span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>35C3 CTF</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Duc Phan </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="2018-12-30 11:01:14 +0800" >2018-12-30 11:01:14 +0800<i class="unloaded">2018-12-30T11:01:14+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2040 ">11 </span></div></div><div class="post-content"><p>This is my first time participating in C3 CTF. Although I wasn’t able to solve many challenges within the time of the CTF, I still find the challenges really awesome and exciting. I wanted to solve pwnable challenges with the hope to learn more about exploit development of real applications, but ended up solving 2 RE ones. Here is my writeup for them :)</p><h2 id="re---corebot">RE - Corebot</h2><p>This challenge is a 32-bit Windows binary. When I tried running the binary for the first time, it was odd because it didn’t prompt for any input and just printed out <code class="language-plaintext highlighter-rouge">NOPE.</code> However, the logic of the binary is pretty straight forward:</p><ul><li>There is a sequence of API calls to crypto-related functions such as:<ul><li><code class="language-plaintext highlighter-rouge">CryptAcquireContext</code><li><code class="language-plaintext highlighter-rouge">CryptImportKey</code><li><code class="language-plaintext highlighter-rouge">CryptSetKeyParam</code><li><code class="language-plaintext highlighter-rouge">CryptDecrypt</code></ul><li>There is a API call to <code class="language-plaintext highlighter-rouge">GetVolumeInformation</code> to get information of the partition that the binary is on. Only the serial number of the volume is relevant to the rest of the challenge.<li>The binary performs some comparison at the end of the <code class="language-plaintext highlighter-rouge">_start</code> function after decrypting some data. It will print out <code class="language-plaintext highlighter-rouge">NOPE.</code> if the decrypted data doesn’t starts with some predefined bytes (in this case, it is the flag prefix <code class="language-plaintext highlighter-rouge">35C3</code>)</ul><p>This reminds me a lot of level 4 of this year Flare-on challenge, which was also a windows binary involving some data decryption. Although this is much simpler, there are at least these 2 ways to solve this:</p><ul><li>Statically reverse engineer the encryption and figure out what is the correct input that satisfies the condition after some data is decrypted.<li>Bruteforce the input.</ul><p>The problem now is to find what data affect the comparison since it doesn’t prompt for any user input. It turned out that the binary use the serial number mentioned above to carry out the calculation. The serial number is a 32-bit integer. However, only the lower 16-bit (or 2 bytes) are used for the calculation</p><p><img data-proofer-ignore data-src="/assets/img/35c3/corebot1.png" alt="corebot-1" /></p><p>With only 2 bytes being used, I chose to bruteforce the data immediately. This time, I decided to use the <code class="language-plaintext highlighter-rouge">radare2</code> scripting engine <code class="language-plaintext highlighter-rouge">r2pipe</code> to solve this so that I can learn it at the same time. <code class="language-plaintext highlighter-rouge">r2pipe</code> is really awesome because it can actually carry out commands as if you were interacting with <code class="language-plaintext highlighter-rouge">radare2</code> to debug the binary. Since there is no user input, the data has to be modified during execution. The idea is to set a breakpoint right after the program get the serial number and modify the register accordingly.</p><p>I am certain that my script can be further optimized, but it was good enough to solve the challenge in-time. There were a few problems that I encountered while writing the script:</p><ul><li>The code is unmapped before it was execute so I have to figure out the mapped addresses to set the necessary breakpoints.<li>The script run fairly slowly because I have to open a whole new <code class="language-plaintext highlighter-rouge">radare2</code> process for every trial. I think there is a way to redirect the execution so that it doesn’t have to run from scratch like that, but reuses the data it obtained before. I optimized it a little bit by running 2 threads and printing the output while it is running. I’ve tried with more threads but it bugged out after a while. While it was still running, I looked for the flag string in the output and figured out the flag and the correct bytes to be <code class="language-plaintext highlighter-rouge">0x25c3</code>. The flag is <code class="language-plaintext highlighter-rouge">35C3_MalwareAuthorKryptoChef</code>.</ul><p>If you know of a way that I can further optimize this, I would love to know since this is my first time solving a challenge with <code class="language-plaintext highlighter-rouge">r2pipe</code>.</p><p>Anyway, here’s the script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="n">r2pipe</span>
<span class="kn">from</span> <span class="n">multiprocessing.dummy</span> <span class="kn">import</span> <span class="n">Pool</span> <span class="k">as</span> <span class="n">ThreadPool</span>

<span class="n">hook_1</span> <span class="o">=</span> <span class="mh">0x19a</span>
<span class="n">hook_2</span> <span class="o">=</span> <span class="mh">0x13f</span>
<span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">r2Breakpoint</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">db {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2pipe</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">corebot.exe</span><span class="sh">'</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">-2</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">aaa</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">doo</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dc</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># Figure out the mapped addresses
</span>    <span class="n">memmap</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dm</span><span class="sh">'</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">memmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">memmap</span> <span class="k">if</span> <span class="sh">'</span><span class="s">corebot.exe</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">.text</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">memmap</span> <span class="o">=</span> <span class="n">memmap</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">memmap</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">memmap</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="c1"># Then set the breakpoints
</span>    <span class="nf">r2Breakpoint</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="nf">hex</span><span class="p">(</span><span class="n">memmap</span> <span class="o">+</span> <span class="n">hook_1</span><span class="p">))</span>
    <span class="nf">r2Breakpoint</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="nf">hex</span><span class="p">(</span><span class="n">memmap</span> <span class="o">+</span> <span class="n">hook_2</span><span class="p">))</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dc</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># The breakpoint is hit. Modify the register here
</span>    <span class="n">eax</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dr?eax</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">eax</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="p">(</span><span class="n">eax</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">key</span>
    <span class="n">seteax</span> <span class="o">=</span> <span class="sh">'</span><span class="s">dr eax={}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">eax</span><span class="p">))</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="n">seteax</span><span class="p">)</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dr?eax</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># Continue running and hit the breakpoint where the output is going to be printed out.
</span>    <span class="c1"># Fetch the output then print it out.
</span>    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">dc</span><span class="sh">'</span><span class="p">)</span>
    <span class="nb">buffer</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">pv @esp+4</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">pvz @{}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nb">buffer</span><span class="p">))</span>
    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">q</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="nc">ThreadPool</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">solve</span><span class="p">,</span> <span class="nf">range</span><span class="p">(</span><span class="mh">0x10000</span><span class="p">))</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">output.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="sh">'</span><span class="s"> == </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]))</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

<span class="c1"># 0x25c3
</span></pre></table></code></div></div><h2 id="re---0pack">RE - 0pack</h2><p>This is not a hard challenge, but it’s still a little bit tricky to solve. When I opened the binary in a disassembler, the functions were all <code class="language-plaintext highlighter-rouge">0</code> as described. Running the binary and giving it some dummy input resulted in the string <code class="language-plaintext highlighter-rouge">Awwww ಠ_ಠ</code> to be printed.</p><p><img data-proofer-ignore data-src="/assets/img/35c3/0pack1.png" alt="0pack-1" /></p><p>As expected, this is some kind of binary packing. I thought the binary will be calling the main function at some point. I gave it a shot by placing a breakpoint at the call to <code class="language-plaintext highlighter-rouge">__libc_start_main</code> with the hope that the address of the real main function would be revealed here. And it was. I realized this because of the reference to the prompt <code class="language-plaintext highlighter-rouge">Input password:</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
</pre><td class="rouge-code"><pre>➜  0pack r2 -A -d 0pack.elf
Process with PID 28177 started...
= attach 28177 28177
bin.baddr 0x557b2e3d6000
Using 0x557b2e3d6000
asm.bits 64
[ WARNING : block size exceeding max block size at 0x557b2e3d6e7d
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d96cc
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d89e1
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d936b
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d7f52
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d9b93
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d67a8
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d752f
[+] Try changing it with e anal.bb.maxsize
 WARNING : block size exceeding max block size at 0x557b2e3d6759
[+] Try changing it with e anal.bb.maxsize
[x] Analyze all flags starting with sym. and entry0 (aa)
[x] Analyze function calls (aac)
[x] Analyze len bytes of instructions for references (aar)
[x] Constructing a function name for fcn.* and sym.func.* functions (aan)
[TOFIX: afta can't run in debugger mode.ions (afta)
[x] Type matching analysis for all functions (afta)
[x] Use -AA or aaaa to perform additional experimental analysis.
= attach 28177 28177
28177
 -- Wrong argument
[0x7f9f17df2090]&gt; db sym.imp.__
sym.imp.__stack_chk_fail    sym.imp.__libc_start_main   sym.imp.__cxa_finalize      
[0x7f9f17df2090]&gt; db sym.imp.__libc_start_main 
[0x7f9f17df2090]&gt; dc
hit breakpoint at: 557b2e3e8770
[0x557b2e3e8770]&gt; dr
rax = 0x0000001c
rbx = 0x00000000
rcx = 0x557b2e3e8e90
rdx = 0x7fff8df34b88
r8 = 0x557b2e3e8f00
r9 = 0x7f9f17e019a0
r10 = 0x557b2e3e87b0
r11 = 0x00000000
r12 = 0x557b2e3d6000
r13 = 0x7fff8df34b80
r14 = 0x00000000
r15 = 0x557b2e3d6000
rsi = 0x00000001
rdi = 0x557b2e3e89a0
rsp = 0x7fff8df34b68
rbp = 0x00000000
rip = 0x557b2e3e8770
rflags = 0x00000202
orax = 0xffffffffffffffff
[0x557b2e3e8770]&gt; sr rdi;pd 30
            ;-- rdi:
            0x557b2e3e89a0      55             push rbp
            0x557b2e3e89a1      4889e5         mov rbp, rsp
            0x557b2e3e89a4      4881eca00000.  sub rsp, 0xa0
            0x557b2e3e89ab      89bd6cffffff   mov dword [rbp - 0x94], edi
            0x557b2e3e89b1      4889b560ffff.  mov qword [rbp - 0xa0], rsi
            0x557b2e3e89b8      64488b042528.  mov rax, qword fs:[0x28] ; [0x28:8]=-1 ; '(' ; 40
            0x557b2e3e89c1      488945f8       mov qword [rbp - 8], rax
            0x557b2e3e89c5      31c0           xor eax, eax
            0x557b2e3e89c7      c6857dffffff.  mov byte [rbp - 0x83], 1
            0x557b2e3e89ce      48b8496e7075.  movabs rax, 0x6170207475706e49 ; 'Input pa'
            0x557b2e3e89d8      48894590       mov qword [rbp - 0x70], rax
            0x557b2e3e89dc      48b87373776f.  movabs rax, 0x203a64726f777373 ; 'ssword: '
            0x557b2e3e89e6      48894598       mov qword [rbp - 0x68], rax
            0x557b2e3e89ea      c645a000       mov byte [rbp - 0x60], 0
            0x557b2e3e89ee      488d4590       lea rax, [rbp - 0x70]
            0x557b2e3e89f2      4889c6         mov rsi, rax
            0x557b2e3e89f5      488d3d180500.  lea rdi, [0x557b2e3e8f14] ; "%s"
            0x557b2e3e89fc      b800000000     mov eax, 0
            0x557b2e3e8a01      e85afdffff     call sym.imp.printf     ; int printf(const char *format)
            0x557b2e3e8a06      488b15531620.  mov rdx, qword [0x557b2e5ea060] ; section..bss ; [0x557b2e5ea060:8]=0x7f9f17deba00
            0x557b2e3e8a0d      488d4580       lea rax, [rbp - 0x80]
            0x557b2e3e8a11      be0f000000     mov esi, 0xf            ; 15
            0x557b2e3e8a16      4889c7         mov rdi, rax
            0x557b2e3e8a19      e862fdffff     call sym.imp.fgets      ; char *fgets(char *s, int size, FILE *stream)
            0x557b2e3e8a1e      bf0a000000     mov edi, 0xa
            0x557b2e3e8a23      e818fdffff     call sym.imp.putchar    ; int putchar(int c)
            0x557b2e3e8a28      0fb64580       movzx eax, byte [rbp - 0x80]
            0x557b2e3e8a2c      88857effffff   mov byte [rbp - 0x82], al
            0x557b2e3e8a32      4c89f8         mov rax, r15
            0x557b2e3e8a35      480575240100   add rax, 0x12475
[0x557b2e3e89a0]&gt; 
</pre></table></code></div></div><p>After a quick look at this function, I made the following observations:</p><ul><li><p>The function gets the input then perform byte-by-byte comparison of the input. This is an example of the comparison of 1 byte. If the comparison fails, it sets a variable to 0 but doesn’t immediately stop the process. There are 14 such comparisons so the password is 14-byte long.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>          0x557b2e3e8a28      0fb64580       movzx eax, byte [rbp - 0x80]
          0x557b2e3e8a2c      88857effffff   mov byte [rbp - 0x82], al
          0x557b2e3e8a32      4c89f8         mov rax, r15
          0x557b2e3e8a35      480575240100   add rax, 0x12475
          0x557b2e3e8a3b      0fb600         movzx eax, byte [rax]
          0x557b2e3e8a3e      88857fffffff   mov byte [rbp - 0x81], al
          0x557b2e3e8a44      0fb6857effff.  movzx eax, byte [rbp - 0x82]
          0x557b2e3e8a4b      3a857fffffff   cmp al, byte [rbp - 0x81]
      ,=&lt; 0x557b2e3e8a51      750e           jne 0x557b2e3e8a61
      |   0x557b2e3e8a53      b800000000     mov eax, 0
      |   0x557b2e3e8a58      e8cafeffff     call 0x557b2e3e8927
      |   0x557b2e3e8a5d      84c0           test al, al
     ,==&lt; 0x557b2e3e8a5f      7407           je 0x557b2e3e8a68
     |`-&gt; 0x557b2e3e8a61      c6857dffffff.  mov byte [rbp - 0x83], 0
     `--&gt; 0x557b2e3e8a68      0fb64581       movzx eax, byte [rbp - 0x7f]
</pre></table></code></div></div><li><p>In each comparison, a function at <code class="language-plaintext highlighter-rouge">0x557b2e3e8927</code> is called. This function calls another function which involves the <code class="language-plaintext highlighter-rouge">cpuid</code> instruction, so my guess was that it detects virtual machines.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>  [0x5555b0c259a0]&gt; pd 24 @0x5555b0c258e0
  |           0x5555b0c258e0      55             push rbp
  |           0x5555b0c258e1      4889e5         mov rbp, rsp
  |           0x5555b0c258e4      0f31           rdtsc
  |           0x5555b0c258e6      8945e8         mov dword [rbp - 0x18], eax
  |           0x5555b0c258e9      8955ec         mov dword [rbp - 0x14], edx
  |           0x5555b0c258ec      8b45e8         mov eax, dword [rbp - 0x18]
  \           0x5555b0c258ef      8b55ec         mov edx, dword [rbp - 0x14]
              0x5555b0c258f2      48c1e220       shl rdx, 0x20
              0x5555b0c258f6      4809d0         or rax, rdx
              0x5555b0c258f9      488945f0       mov qword [rbp - 0x10], rax
              0x5555b0c258fd      b800000000     mov eax, 0
              0x5555b0c25902      0fa2           cpuid
              0x5555b0c25904      0f31           rdtsc
              0x5555b0c25906      8945e8         mov dword [rbp - 0x18], eax
              0x5555b0c25909      8955ec         mov dword [rbp - 0x14], edx
              0x5555b0c2590c      8b45e8         mov eax, dword [rbp - 0x18]
              0x5555b0c2590f      8b55ec         mov edx, dword [rbp - 0x14]
              0x5555b0c25912      48c1e220       shl rdx, 0x20
              0x5555b0c25916      4809d0         or rax, rdx
              0x5555b0c25919      488945f8       mov qword [rbp - 8], rax
              0x5555b0c2591d      488b45f8       mov rax, qword [rbp - 8]
              0x5555b0c25921      482b45f0       sub rax, qword [rbp - 0x10]
              0x5555b0c25925      5d             pop rbp
              0x5555b0c25926      c3             ret
</pre></table></code></div></div></ul><p>I was able to go through all such comparisons manually and extract the password: <code class="language-plaintext highlighter-rouge">ThisIsATriumph</code>. I think my guess about the VM detection was correct since I was running the binary inside a VM and the extracted password didn’t result in a “winning-output”. I submitted the flag and it was correct :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/reversing/'>reversing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a> <a href="/tags/radare2/" class="post-tag no-text-decoration" >radare2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1"></span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=35C3 CTF - ret2life&url=https://ret2.life/posts/35C3-CTF/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=35C3 CTF - ret2life&u=https://ret2.life/posts/35C3-CTF/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=35C3 CTF - ret2life&url=https://ret2.life/posts/35C3-CTF/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" title-succeed=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Google-CTF-2021/">Google CTF 2021 - Fullchain</a><li><a href="/posts/CSAW-CTF-17-Qual/">CSAW CTF 2017 Qualification</a><li><a href="/posts/AceBear-CTF-19/">AceBear CTF 19</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/browser/">browser</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/radare2/">radare2</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/blue-team/">blue team</a> <a class="post-tag" href="/tags/ccdc/">ccdc</a> <a class="post-tag" href="/tags/chrome/">chrome</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CSAW-CTF-17-Qual/"><div class="card-body"> <span class="timeago small" >Sep 21, 2017<i class="unloaded">2017-09-21T11:48:01+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CSAW CTF 2017 Qualification</h3><div class="text-muted small"><p> This is the write-up for challenges I have done in CSAW CTF Qualification 2017 pwn: pilot (75 pts.) English version here Vietnamese Năm nay mình có cơ hội chơi CSAW CTF một cách thực sự, với ...</p></div></div></a></div><div class="card"> <a href="/posts/AceBear-CTF-19/"><div class="card-body"> <span class="timeago small" >Apr 9, 2019<i class="unloaded">2019-04-09T06:46:23+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AceBear CTF 19</h3><div class="text-muted small"><p> I had a lot of fun and a hard time during this CTF, but the challenges are really awesome. I spent the whole time solving one challenge: Incident Response (Misc 1000). In my opinion, this challenge...</p></div></div></a></div><div class="card"> <a href="/posts/TetCTF-19/"><div class="card-body"> <span class="timeago small" >Jan 1, 2019<i class="unloaded">2019-01-01T14:34:45+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TetCTF 19</h3><div class="text-muted small"><p> This is my write-up for TetCTF 19 Web - IQTest2 (unsolved) Pwn - Easy webserver (unsolved) Pwn - Babysandbox Pwn - Babyheap Pwn - Babyfirst Web IQTest2 After looking at the s...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/H1-702-CTF-2018/" class="btn btn-outline-primary" prompt="Older"><p>H1-702 CTF 2018</p></a> <a href="/posts/TetCTF-19/" class="btn btn-outline-primary" prompt="Newer"><p>TetCTF 19</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Duc Phan</a>.</p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4"></h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/browser/">browser</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/radare2/">radare2</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/blue-team/">blue team</a> <a class="post-tag" href="/tags/ccdc/">ccdc</a> <a class="post-tag" href="/tags/chrome/">chrome</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WN0BSTHR4X"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WN0BSTHR4X'); }); </script>
